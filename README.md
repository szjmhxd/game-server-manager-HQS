# 游戏服务器配置管理系统

一个基于 **Flask + SQLite** 的游戏服务器配置管理系统，专为管理游戏服务器的配置文件而设计，支持用户认证、权限管理和配置文件的完整生命周期管理。

## 🚀 功能特性

### 用户管理
- 用户登录、退出登录
- 修改密码
- 用户权限控制

### 配置文件管理
- 配置文件列表展示（支持分页和筛选）
- 新增配置文件（支持类型选择：qu或modlist）
- 编辑配置文件元数据（名称、版本、路径、备注）
- 编辑配置文件内容（支持JSON格式和自定义字段）
- 软删除配置文件（保留删除记录）

### 权限系统
- 管理员用户可管理所有配置文件
- 普通用户只能访问被授权的配置文件
- 支持为用户分配特定配置文件的访问权限

### 系统特性
- SQLite数据库存储，无需额外安装数据库
- 环境变量控制服务端口和密钥
- 完善的日志系统（每天自动轮转，保留30天）
- 响应式设计，适配不同屏幕尺寸

## 📁 项目结构

```
game-server-manager/
├── app.py              # Flask应用主入口
├── models.py           # 数据库模型和初始化
├── auth.py             # 用户认证相关路由和逻辑
├── views.py            # 配置文件管理相关路由和逻辑
├── templates/          # HTML模板文件
│   ├── layout.html     # 基础布局模板
│   ├── login.html      # 登录页面
│   ├── config_list.html # 配置文件列表页面
│   ├── edit_config.html # 编辑配置文件页面
│   ├── change_password.html # 修改密码页面
│   ├── add_user.html   # 添加用户页面
│   ├── manage_permissions.html # 管理权限页面
│   └── edit_content.html # 编辑配置内容页面
├── static/             # 静态资源文件
│   └── style.css       # 样式表
├── .env                # 环境变量配置文件
├── logs/               # 日志文件目录
│   ├── app.log         # 当前日志文件
│   └── app.log.日期    # 历史日志文件
└── data.db             # SQLite数据库文件（自动生成）
```

## ⚙️ 环境要求

- Python 3.8 及以上版本
- pip 包管理器

## 📦 安装步骤

1. **克隆项目**

```bash
git clone https://your-repo-url/game-server-manager.git
cd game-server-manager
```

2. **安装依赖**

```bash
pip install flask python-dotenv werkzeug
```

3. **配置环境变量**

在项目根目录创建或编辑 `.env` 文件：

```ini
SECRET_KEY=your_secret_key_here
APP_PORT=5000
```

> **提示**：
> - `SECRET_KEY` 用于加密 session，建议设置为随机字符串以提高安全性
> - `APP_PORT` 控制服务运行的端口号，可根据需要修改

4. **初始化数据库**

首次运行项目时会自动初始化 SQLite 数据库，并创建以下表：
- `users`: 存储用户信息
- `config_files`: 存储配置文件元数据
- `column_comments`: 存储字段注释
- `user_config_permissions`: 存储用户配置文件权限关系

系统还会自动创建默认管理员账号：
- 用户名：`admin`
- 密码：`admin123`

## 🎮 启动服务

### 直接启动

```bash
python app.py
```

服务将在配置的端口上启动，默认为 `5000`。

### 后台启动（Windows）

使用项目提供的批处理文件启动：

```bash
start_background.bat
```

## 🔍 使用说明

### 访问系统

启动服务后，在浏览器中访问： [http://localhost:5000](http://localhost:5000)

### 用户模块

#### 登录
- 输入用户名和密码进行登录
- 默认管理员账号：`admin`/`admin123`

#### 修改密码
- 登录后，点击右上角的「修改密码」
- 输入当前密码和新密码进行修改

#### 退出登录
- 点击右上角的「退出」按钮

### 配置文件模块

#### 配置文件列表
- 展示所有未删除的配置文件
- 管理员可查看所有配置文件，普通用户只能查看被授权的配置文件

#### 新增配置文件
- 点击「新增配置」按钮
- 填写配置文件信息：类型（qu或modlist）、名称、版本、文件路径、备注
- 系统会自动生成UUID标识

#### 编辑配置文件
- 在配置文件列表中，点击「编辑」按钮
- 修改配置文件的元数据信息

#### 编辑配置内容
- 在配置文件列表中，点击「编辑内容」按钮
- 编辑配置文件的JSON内容，支持`serverData`字段和顶部自定义字段

#### 删除配置文件
- 在配置文件列表中，点击「删除」按钮
- 配置文件将被软删除（记录删除时间但不实际删除数据）

### 权限管理

#### 添加用户
- 管理员可点击「添加用户」按钮创建新用户
- 设置用户名和初始密码

#### 管理权限
- 管理员可点击「管理权限」按钮
- 为普通用户分配特定配置文件的访问权限

## 💾 数据存储

- **数据库**：SQLite，存储在 `data.db` 文件中
- **配置文件**：实际的配置文件以 `.txt` 格式存储在指定路径，路径信息存储在数据库中
- **日志**：存储在 `logs/` 目录下，每天自动轮转，保留30天的历史日志

## 🔑 安全建议

- 首次登录后，请立即修改默认管理员密码
- 为不同用户分配适当的配置文件访问权限
- 定期备份 `data.db` 数据库文件
- 定期查看 `logs/app.log` 日志文件，监控系统运行情况

## 🛠️ 常见问题

### 登录失败
- 确认数据库中 `users` 表是否存在，检查是否有有效的用户记录
- 检查输入的用户名和密码是否正确

### 页面样式错乱
- 确认 `static/style.css` 文件是否存在且格式正确
- 检查浏览器缓存，尝试清除缓存后重新加载页面

### 端口被占用
- 修改 `.env` 文件中的 `APP_PORT` 配置项
- 停止占用该端口的其他应用程序

### 配置文件无法访问
- 确认配置文件路径是否正确
- 确认当前用户是否有权限访问该配置文件

### 日志文件过大
- 系统会自动管理日志轮转，但如果需要手动清理，可直接删除 `logs/` 目录下的历史日志文件

## 📝 更新日志

### 最新版本
- 添加了配置文件类型支持（qu或modlist）
- 引入了UUID字段标识配置文件
- 完善了权限管理系统
- 优化了日志管理，实现自动轮转

## 🤝 贡献说明

欢迎提交Issue和Pull Request来帮助改进这个项目。在提交代码前，请确保：
- 代码风格与现有代码保持一致
- 添加必要的注释和文档
- 测试代码是否正常运行

## 📄 许可证

[MIT License](https://opensource.org/licenses/MIT)

---

**提示**：本系统仅供内部使用，建议在安全的网络环境中部署和使用。