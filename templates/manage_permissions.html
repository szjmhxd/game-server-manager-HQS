{% extends "layout.html" %}

{% block content %}
<h1>用户配置文件权限管理</h1>
{% with messages = get_flashed_messages() %}
{% if messages %}
<ul>
  {% for message in messages %}
  <li>{{ message }}</li>
  {% endfor %}
</ul>
{% endif %}
{% endwith %}
<form method="post">
  <label>选择用户：</label>
  <select name="user_id" id="user_id">
    {% for user in users %}
    <option value="{{ user[0] }}" {% if user[0]==selected_user_id %}selected{% endif %}>{{ user[1] }}</option>
    {% endfor %}
  </select>
  <button type="submit" name="action" value="switch">切换用户</button>
  <br><br>
  <label>可访问的配置文件：</label>
  <br>
  {% for cf in config_files %}
  <input type="checkbox" name="config_file_ids" value="{{ cf[0] }}" {% if cf[0] in
    (user_permissions.get(selected_user_id) or []) %}checked{% endif %}>
  {{ cf[1] }} <!-- 显示配置文件名称 -->
  <br>
  {% endfor %}
  <br>
  <button type="submit" name="action" value="save">保存权限</button>
</form>
{% endblock %}